<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Henry Zhu | Machine Learning with League of Legends - Minimap Detection (Part 1)</title>
  <meta name="description" content="Personal website for random stuff
">

  
  <meta property="og:site_name" content="Personal website for random stuff
" />
  <meta property="og:type" content="object" />
  <meta property="og:title" content="Henry Zhu" />
  <meta property="og:url" content="/blog/2021/League-ML-Minimap-Detection1/" />
  <meta property="og:description" content="Machine Learning with League of Legends - Minimap Detection (Part 1)" />
  <meta property="og:image" content="" />
  

  <link rel="shortcut icon" href="/assets/images/favicon.ico">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="canonical" href="/blog/2021/League-ML-Minimap-Detection1/">
</head>

<body>

  <header class="site-header">

  <div class="wrapper">

    
    <span class="site-title">
      
      <strong>Henry</strong> Zhu
    </span>
    

    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" />
            <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" />
            <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" />
          </svg>
        </span>
      </label>

      <div class="trigger">
        <!-- Blog -->
        <a class="page-link" href="/blog/">blog</a>

        <!-- Pages -->
        
        
        
        
        
        
        
        
        <a class="page-link" href="/projects/">projects</a>
        
        
        
        <a class="page-link" href="/publications/">publications</a>
        
        
        
        

        <!-- About -->
        <a class="page-link" href="/">about</a>

        <!-- CV link -->
        <!-- <a class="page-link" href="/assets/pdf/CV.pdf">vitae</a> -->

      </div>
    </nav>

  </div>

</header>


  <div class="page-content">
    <div class="wrapper">
      <div class="post">

  <header class="post-header">
    <h1 class="post-title">Machine Learning with League of Legends - Minimap Detection (Part 1)</h1>
    <p class="post-meta">September 5, 2021</p>
  </header>

  <article class="post-content">
    <center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/icon.jpg" width="100% 50% " alt="" />
        </center>
        
    </p>
</center>

<h2 id="links-to-series">Links to series</h2>

<ul>
  <li><a href="/blog/2020/League-ML-Intro/">Introduction</a></li>
  <li><a href="/blog/2021/League-ML-Minimap-Detection1/">Minimap Detection</a></li>
  <li><a href="/blog/2021/League-ML-Minimap-Detection2/">Minimap Detection v2</a></li>
</ul>

<h3 id="updates">Updates</h3>

<ul>
  <li><span style="color:DeepSkyBlue"><strong>This was made back in March 2020 right as COVID hit. After over a year of forgetting to upload this post, I finally uploaded.</strong></span></li>
</ul>

<h2 id="abstract">Abstract</h2>

<p>The minimap is an important feature in the popular online MOBA, League of Legends. Automatic detection of champions icons on the minimap can provide additional information.</p>

<h2 id="introduction">Introduction</h2>

<p>The minimap in League of Legends is a global view of the state of the game contained in a top down 2D view of the map. The minimap contains information such as the position of the ally champions, positions of enemy champions (if they are visible), visibility covered by wards, what towers and inhibitors are up, etc…</p>

<p>The minimap is an extremely important tool that a player can view to gain more information about the current state of the game.</p>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/minimap.png" width="100% 50% " alt="" />
        </center>
        
        <center>
            <em>League of Legends minimap
                
            </em>
        </center>
        
    </p>
</center>

<p>Champions also appear on the minimap (visually with the champion image as an icon). Detecting champion on the minimap can produce useful information – aiding in helping players visually see enemy champions appear, tracking the movements of professional players, etc. Let’s tackle this problem!</p>

<h2 id="why-not-use-classical-computer-vision-algorithms">Why not use classical computer vision algorithms?</h2>

<p>Detection of champion seems simple enough for an attempt to use classical computer vision algorithms/techniques.</p>

<p>A system that could detect champions on the minimap fairly well was built using <a href="https://opencv.org/">OpenCV Library</a> (one of the most popular open-source computer vision library).</p>

<p>So, I attempted to make a detection system using opencv.</p>

<p><a href="https://github.com/Maknee/LeagueMinimapDetectionOpenCV">The source is here</a></p>

<p>The detection is split into two parts; the top image detects champions on the red side and the bottom image detects champions on the blue side.</p>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_result.gif" width="50% 50% " alt="" />
        </center>
        
        <center>
            <em>OpenCV results
                
            </em>
        </center>
        
    </p>
</center>

<p>An high level overview of detection is presented in the following pipeline image:</p>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_demo.gif" width="100% 50% " alt="" />
        </center>
        
        <center>
            <em>OpenCV pipeline
                
            </em>
        </center>
        
    </p>
</center>

<p>The first step of the pipeline is to use <a href="https://docs.opencv.org/3.4/da/d97/tutorial_threshold_inRange.html">cv2.inRange</a> to filter out colors belonging to the circle border belonging to champion icons in order to focus on parts of the minimap that could possibly contain a champion.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">filter_red</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimap</span><span class="p">):</span>
<span class="n">lower_red</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">upper_red</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">255</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>

    <span class="c1"># filter only colors in the minimap between lower_red and upper_red
</span>    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">minimap</span><span class="p">,</span> <span class="n">lower_red</span><span class="p">,</span> <span class="n">upper_red</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span></code></pre></figure>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_filter.gif" width="100% 50% " alt="" />
        </center>
        
        <center>
            <em>Filter the color from the minimap
                
            </em>
        </center>
        
    </p>
</center>

<p>The next step is to use <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_contours/py_contours_begin/py_contours_begin.html">cv2.findContours</a> to find a curve joining continous points (basically any line of points that are connected). The boundaries of the contours are computed with <a href="https://docs.opencv.org/3.4/dd/d49/tutorial_py_contour_features.html">cv2.minEnclosingCircle</a> and they are checked to ensure that they are at least the size of a champion icon.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">find_champions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">color_filtered_minimap</span><span class="p">):</span>
<span class="n">contours</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span>
<span class="n">color_filtered_minimap</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span> <span class="c1"># find circle enclosing the contour
</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">r</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minEnclosingCircle</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="o">...</span>

        <span class="c1"># some checks to make sure the
</span>        <span class="c1"># circle size is big enough to be a champion icon
</span>        <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">40</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">height</span><span class="p">:</span>
            <span class="o">...</span></code></pre></figure>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_contours.gif" width="100% 50% " alt="" />
        </center>
        
        <center>
            <em>Find contours and verify if the contours' size
                
            </em>
        </center>
        
    </p>
</center>

<p>Lastly, <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_imgproc/py_template_matching/py_template_matching.html">cv2.matchTemplate</a> is used to find the location of champion icons in the regions found using contours. A threshold is used to ensure that enough of the image matches the champion.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">find_champions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">color_filtered_minimap</span><span class="p">):</span>
<span class="o">...</span>
<span class="k">for</span> <span class="n">champion</span><span class="p">,</span> <span class="n">icon</span> <span class="ow">in</span> <span class="n">icons</span><span class="p">:</span> <span class="c1"># match the template of the champion with the contour
</span><span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">matchTemplate</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">icon</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">TM_CCOEFF_NORMED</span><span class="p">)</span>

        <span class="c1"># check that the result meets a threshold
</span>        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">res</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>
        <span class="o">...</span></code></pre></figure>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_detection.gif" width="100% 50% " alt="" />
        </center>
        
        <center>
            <em>Matching template with contours
                
            </em>
        </center>
        
    </p>
</center>

<h3 id="pitfalls">Pitfalls</h3>

<p>As one may notice, the system is not perfect; champions are not detected frequently as one would expect and there are sometimes false positive labels.</p>

<p>Some examples include:</p>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_overlay.gif" width="50% 50% " alt="" />
        </center>
        
        <center>
            <em>The overlay of the white box affects detection; the system incorrectly labels Janna as Jayce or does not detect Janna
                
            </em>
        </center>
        
    </p>
</center>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_overlay2.gif" width="50% 50% " alt="" />
        </center>
        
        <center>
            <em>Another example of the effects with overlay; Fizz is not detected for a duration when the ping is active
                
            </em>
        </center>
        
    </p>
</center>

<center>
    <p>
        <center>
            <img src="/assets/images/posts/2021-09-05/opencv_overlay3.png" width="50% 50% " alt="" />
        </center>
        
        <center>
            <em>False negative; a seemingly random spot is detected as Caitlyn
                
            </em>
        </center>
        
    </p>
</center>

<h3 id="conclusion-future-work-and-moving-forward">Conclusion, future work and moving forward</h3>

<p>In the perfect scenario, where there are no overlaying objects (even other champions can overlay another champion partially or fully), the system can still fail to detect certain champions or miscategorize seemingly random parts of the minimap as another champion.</p>

<p>The miscategorization is affected by the threshold. I have not found a perfect threshold to balance finding champions and generating miscategorizations.</p>

<p>Future work include using <a href="https://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_feature2d/py_orb/py_orb.html">ORB</a> or <a href="https://docs.opencv.org/trunk/da/df5/tutorial_py_sift_intro.html">SIFT</a> to extract keypoints and find features that match the champion icons, which may improve image detection significantly.</p>

<p>Now that we have an idea of what problems there are, the next <a href="/blog/2021/League-ML-Minimap-Detection2/">post</a> discusses an improved approach in detail.</p>

  </article>

  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'https-maknee-github-io';
    var disqus_identifier = '/blog/2021/League-ML-Minimap-Detection1';
    var disqus_title = "Machine Learning with League of Legends - Minimap Detection (Part 1)";
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

</div>
    </div>
  </div>

  <div class="wrapper">
  &copy; Copyright 2021 Henry Zhu.
  
  
</div>

  <!-- Load jQuery -->
<script src="//code.jquery.com/jquery-1.12.4.min.js"></script>

<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>


<!-- Load KaTeX -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.js"></script>
<script src="/assets/js/katex.js"></script>



<!-- Load Anchor JS -->
<script src="//cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
<script>
  anchors.options.visible = 'always';
  anchors.add('article h2, article h3, article h4, article h5, article h6');
</script>


<!-- Include custom icon fonts -->
<link rel="stylesheet" href="/assets/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/assets/css/academicons.min.css">


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-124405916-1', 'auto');
ga('send', 'pageview');
</script>



</body>

</html>